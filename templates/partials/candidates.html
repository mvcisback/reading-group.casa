<section aria-label="Candidate papers" class="rounded-3xl border border-slate-800 bg-slate-900 p-6 shadow-2xl">
  <header class="mb-4">
    <h2 class="text-xl font-semibold text-white">Candidate list</h2>
    <p class="text-sm text-slate-400">
      {% if user %}
        Assign each paper a priority to move it through the queue.
      {% else %}
        Log in to prioritize each paper and update the queue order.
      {% endif %}
    </p>
  </header>
  {% if papers %}
    <div class="space-y-4">
      {% for paper in papers %}
        <article class="rounded-2xl border border-slate-800 bg-slate-950 p-5">
          <header class="flex flex-col gap-2">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <p class="text-lg font-semibold text-white">{{ paper.title }}</p>
              <div class="flex flex-wrap items-center gap-2 text-[0.65rem] uppercase tracking-[0.3em] text-slate-300">
                <span class="rounded-full border border-slate-700 px-3 py-1 font-semibold">{{ paper.priority_label }} priority</span>
                <span class="rounded-full border border-slate-700 px-3 py-1 font-semibold">{{ paper.priority_votes }} votes</span>
                <span class="rounded-full border border-slate-700 px-3 py-1 font-semibold">Avg {{ paper.priority_score_display }}</span>
              </div>
            </div>
            {% if paper.user_priority_label %}
              <p class="text-xs font-semibold uppercase tracking-[0.4em] text-slate-300">You prioritized this as {{ paper.user_priority_label }}</p>
            {% endif %}
          </header>
          <div class="mt-3 flex flex-wrap gap-3 text-sm text-slate-300">
            {% if paper.paper_url %}
              <a href="{{ paper.paper_url }}" target="_blank" rel="noreferrer" class="rounded-full bg-slate-900 px-3 py-1 transition hover:bg-slate-800">View paper</a>
            {% else %}
              <span class="rounded-full bg-slate-900 px-3 py-1 text-slate-500">No link</span>
            {% endif %}
          </div>
          {% if user %}
            <div class="mt-4 flex flex-col gap-3">
              {% set button_base = "flex-1 rounded-2xl border px-4 py-2 text-xs font-semibold uppercase tracking-[0.3em] transition focus:outline-none" %}
              {% set button_muted = "border-slate-700 bg-slate-800 text-slate-400 hover:border-slate-600 hover:bg-slate-700" %}
              {% set active_low = "border-slate-300 bg-slate-200 text-slate-900" %}
              {% set active_medium = "border-sky-300 bg-sky-400 text-slate-900" %}
              {% set active_high = "border-amber-300 bg-amber-400 text-slate-900" %}
              {% set active_critical = "border-rose-300 bg-rose-500 text-slate-950" %}
              <form method="post" action="/papers/{{ paper.id }}/vote" hx-post="/papers/{{ paper.id }}/vote" hx-target="#candidates-panel" hx-swap="innerHTML" class="flex flex-wrap gap-2">
                <button
                  type="submit"
                  name="priority"
                  value="1"
                  class="{{ button_base }} {{ active_low if paper.user_priority == 1 else button_muted }}"
                >
                  Low
                </button>
                <button
                  type="submit"
                  name="priority"
                  value="2"
                  class="{{ button_base }} {{ active_medium if paper.user_priority == 2 else button_muted }}"
                >
                  Medium
                </button>
                <button
                  type="submit"
                  name="priority"
                  value="3"
                  class="{{ button_base }} {{ active_high if paper.user_priority == 3 else button_muted }}"
                >
                  High
                </button>
                <button
                  type="submit"
                  name="priority"
                  value="4"
                  class="{{ button_base }} {{ active_critical if paper.user_priority == 4 else button_muted }}"
                >
                  Critical
                </button>
              </form>
              <div class="space-y-2 text-[0.65rem] uppercase tracking-[0.3em] text-slate-400">
                {% for bar in paper.priority_histogram %}
                  <div class="flex items-center gap-3">
                    <span class="w-16 text-xs font-semibold text-slate-400">{{ bar.label }}</span>
                    <div class="flex-1 overflow-hidden rounded-full bg-slate-800">
                      <span class="block h-1 {{ bar.bar_class }}" style="width: {{ bar.percent }}%;"></span>
                    </div>
                    <span class="w-8 text-right text-xs font-semibold text-slate-200">{{ bar.count }}</span>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% else %}
            <div class="mt-4">
              <button type="button" disabled class="w-full rounded-2xl border border-slate-700 bg-slate-800 px-4 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-slate-500 cursor-not-allowed">Log in to prioritize</button>
            </div>
          {% endif %}
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-sm text-slate-400">No papers registered yet. Use the nomination form to add one.</p>
  {% endif %}
</section>
