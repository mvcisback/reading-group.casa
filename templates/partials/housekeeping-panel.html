<section>
  <header class="mb-8 space-y-1">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div>
        <p class="text-xs uppercase tracking-[0.5em] text-slate-500">Housekeeping</p>
        <h3 class="text-2xl font-semibold text-white">Archive or delete papers</h3>
      </div>
      <p class="text-xs text-slate-400">Actions refresh this panel automatically.</p>
    </div>
    {% if not user %}
      <p class="text-sm text-amber-300">Log in to archive or delete papers.</p>
    {% endif %}
  </header>
  <section aria-label="Upcoming queue" class="space-y-4">
    <div class="flex items-center justify-between">
      <h4 class="text-lg font-semibold text-white">Queue</h4>
      <span class="text-xs uppercase tracking-[0.4em] text-slate-500">Priority</span>
    </div>
    {% if queue_papers %}
      <div class="space-y-4">
        {% for paper in queue_papers %}
          <article class="rounded-2xl border border-slate-800 bg-slate-950 p-5">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <p class="text-lg font-semibold text-white">{{ paper.title }}</p>
              <span class="rounded-full bg-slate-800 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-slate-300">{{ paper.priority_label }} priority</span>
            </div>
            <div class="mt-2 flex flex-wrap gap-3 text-sm text-slate-400">
              <span>Avg {{ paper.priority_score_display }}</span>
              <span>{{ paper.priority_votes }} votes</span>
            </div>
            {% if paper.paper_url %}
              <a href="{{ paper.paper_url }}" target="_blank" rel="noreferrer" class="mt-3 inline-flex rounded-full bg-slate-900 px-3 py-1 text-sm text-slate-300 transition hover:bg-slate-800">View paper</a>
            {% endif %}
            {% if user %}
              <div class="mt-4 flex flex-wrap gap-2 text-[0.65rem] uppercase tracking-[0.3em] text-slate-400">
                {% if paper.assigned_reader_id == user.id %}
                  <form
                    method="post"
                    action="/papers/{{ paper.id }}/unassign"
                    hx-post="/papers/{{ paper.id }}/unassign"
                    hx-target="#housekeeping-panel"
                    hx-swap="innerHTML"
                  >
                    <input type="hidden" name="panel" value="housekeeping" />
                    <button
                      type="submit"
                      class="rounded-2xl border border-rose-500 bg-rose-500/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-rose-100 transition hover:border-rose-400 hover:bg-rose-500/20"
                    >
                      Release reader
                    </button>
                  </form>
                {% endif %}
                <form
                  method="post"
                  action="/papers/{{ paper.id }}/archive"
                  hx-post="/papers/{{ paper.id }}/archive"
                  hx-target="#housekeeping-panel"
                  hx-swap="innerHTML"
                >
                  <button
                    type="submit"
                    class="rounded-2xl border border-slate-700 bg-slate-800 px-3 py-1 text-xs font-semibold text-slate-300 transition hover:border-slate-600 hover:bg-slate-700"
                  >
                    Archive
                  </button>
                </form>
                <form
                  method="post"
                  action="/papers/{{ paper.id }}/mark-covered"
                  hx-post="/papers/{{ paper.id }}/mark-covered"
                  hx-target="#housekeeping-panel"
                  hx-swap="innerHTML"
                >
                  <input type="hidden" name="panel" value="housekeeping" />
                  <button
                    type="submit"
                    class="rounded-2xl border border-emerald-500 bg-emerald-500/10 px-3 py-1 text-xs font-semibold text-emerald-200 transition hover:border-emerald-400 hover:bg-emerald-500/20"
                  >
                    Mark covered
                  </button>
                </form>
                <form
                  method="post"
                  action="/papers/{{ paper.id }}/delete"
                  hx-post="/papers/{{ paper.id }}/delete"
                  hx-target="#housekeeping-panel"
                  hx-swap="innerHTML"
                >
                  <button
                    type="submit"
                    class="rounded-2xl border border-rose-600 bg-rose-600/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-rose-200 transition hover:border-rose-500 hover:bg-rose-500/20"
                  >
                    Delete
                  </button>
                </form>
              </div>
            {% endif %}
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-sm text-slate-400">No papers are currently in the queue.</p>
    {% endif %}
  </section>
  <section aria-label="Backlog" class="mt-8 space-y-4">
    <div class="flex items-center justify-between">
      <h4 class="text-lg font-semibold text-white">Backlog</h4>
      <span class="text-xs uppercase tracking-[0.4em] text-slate-500">Candidates</span>
    </div>
    {% if backlog_papers %}
      <div class="space-y-4">
        {% for paper in backlog_papers %}
          <article class="rounded-2xl border border-slate-800 bg-slate-950 p-5">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <p class="text-lg font-semibold text-white">{{ paper.title }}</p>
              <span class="rounded-full bg-slate-800 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-slate-300">{{ paper.priority_label }} priority</span>
            </div>
            <div class="mt-2 flex flex-wrap gap-3 text-sm text-slate-400">
              <span>Avg {{ paper.priority_score_display }}</span>
              <span>{{ paper.priority_votes }} votes</span>
            </div>
            {% if paper.paper_url %}
              <a href="{{ paper.paper_url }}" target="_blank" rel="noreferrer" class="mt-3 inline-flex rounded-full bg-slate-900 px-3 py-1 text-sm text-slate-300 transition hover:bg-slate-800">View paper</a>
            {% endif %}
            {% if user %}
              <div class="mt-4 flex flex-wrap gap-2 text-[0.65rem] uppercase tracking-[0.3em] text-slate-400">
                {% if paper.assigned_reader_id == user.id %}
                  <form
                    method="post"
                    action="/papers/{{ paper.id }}/unassign"
                    hx-post="/papers/{{ paper.id }}/unassign"
                    hx-target="#housekeeping-panel"
                    hx-swap="innerHTML"
                  >
                    <input type="hidden" name="panel" value="housekeeping" />
                    <button
                      type="submit"
                      class="rounded-2xl border border-rose-500 bg-rose-500/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-rose-100 transition hover:border-rose-400 hover:bg-rose-500/20"
                    >
                      Release reader
                    </button>
                  </form>
                {% endif %}
                <form
                  method="post"
                  action="/papers/{{ paper.id }}/archive"
                  hx-post="/papers/{{ paper.id }}/archive"
                  hx-target="#housekeeping-panel"
                  hx-swap="innerHTML"
                >
                  <button
                    type="submit"
                    class="rounded-2xl border border-slate-700 bg-slate-800 px-3 py-1 text-xs font-semibold text-slate-300 transition hover:border-slate-600 hover:bg-slate-700"
                  >
                    Archive
                  </button>
                </form>
                <form
                  method="post"
                  action="/papers/{{ paper.id }}/mark-covered"
                  hx-post="/papers/{{ paper.id }}/mark-covered"
                  hx-target="#housekeeping-panel"
                  hx-swap="innerHTML"
                >
                  <input type="hidden" name="panel" value="housekeeping" />
                  <button
                    type="submit"
                    class="rounded-2xl border border-emerald-500 bg-emerald-500/10 px-3 py-1 text-xs font-semibold text-emerald-200 transition hover:border-emerald-400 hover:bg-emerald-500/20"
                  >
                    Mark covered
                  </button>
                </form>
                <form
                  method="post"
                  action="/papers/{{ paper.id }}/delete"
                  hx-post="/papers/{{ paper.id }}/delete"
                  hx-target="#housekeeping-panel"
                  hx-swap="innerHTML"
                >
                  <button
                    type="submit"
                    class="rounded-2xl border border-rose-600 bg-rose-600/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-rose-200 transition hover:border-rose-500 hover:bg-rose-500/20"
                  >
                    Delete
                  </button>
                </form>
              </div>
            {% endif %}
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-sm text-slate-400">Backlog is empty.</p>
    {% endif %}
  </section>
  <section aria-label="Archived papers" class="mt-8 space-y-4">
    <div class="flex items-center justify-between">
      <h4 class="text-lg font-semibold text-white">Archived papers</h4>
      <span class="text-xs uppercase tracking-[0.4em] text-slate-500">History</span>
    </div>
    {% if archived_papers %}
      <div class="space-y-4">
        {% for paper in archived_papers %}
          <article class="rounded-2xl border border-slate-800 bg-slate-950 p-5">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <p class="text-lg font-semibold text-white">{{ paper.title }}</p>
              <span class="rounded-full bg-slate-800 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-slate-300">Archived</span>
            </div>
            <div class="mt-2 flex flex-wrap gap-3 text-sm text-slate-400">
              <span>Avg {{ paper.priority_score_display }}</span>
              <span>{{ paper.priority_votes }} votes</span>
            </div>
            {% if paper.paper_url %}
              <a href="{{ paper.paper_url }}" target="_blank" rel="noreferrer" class="mt-3 inline-flex rounded-full bg-slate-900 px-3 py-1 text-sm text-slate-300 transition hover:bg-slate-800">View paper</a>
            {% endif %}
            {% if user %}
              <div class="mt-4 flex flex-wrap gap-2 text-[0.65rem] uppercase tracking-[0.3em] text-slate-400">
                <form
                  method="post"
                  action="/papers/{{ paper.id }}/unarchive"
                  hx-post="/papers/{{ paper.id }}/unarchive"
                  hx-target="#housekeeping-panel"
                  hx-swap="innerHTML"
                >
                  <button
                    type="submit"
                    class="rounded-2xl border border-emerald-500 bg-emerald-500/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-emerald-200 transition hover:border-emerald-400 hover:bg-emerald-400/20"
                  >
                    Unarchive
                  </button>
                </form>
                <form
                  method="post"
                  action="/papers/{{ paper.id }}/delete"
                  hx-post="/papers/{{ paper.id }}/delete"
                  hx-target="#housekeeping-panel"
                  hx-swap="innerHTML"
                >
                  <button
                    type="submit"
                    class="rounded-2xl border border-rose-600 bg-rose-600/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-rose-200 transition hover:border-rose-500 hover:bg-rose-500/20"
                  >
                    Delete
                  </button>
                </form>
              </div>
            {% endif %}
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-sm text-slate-400">No archived papers yet.</p>
    {% endif %}
  </section>
</section>
